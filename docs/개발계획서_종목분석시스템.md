# ğŸ“Š ê¸°ê´€íˆ¬ìì í¬íŠ¸í´ë¦¬ì˜¤ ì¢…ëª© ë¶„ì„ ì‹œìŠ¤í…œ

## ê°œë°œê³„íšì„œ v1.2

**ì‘ì„±ì¼**: 2025ë…„ 1ì›” 31ì¼
**í”„ë¡œì íŠ¸ëª…**: Stock Analysis Dashboard
**ë¶„ì„ ë¹„ì¤‘**: ê¸°ìˆ ë¶„ì„(30%) : ê¸°ë³¸ë¶„ì„(50%) : ë‰´ìŠ¤/ê°ì •ë¶„ì„(20%)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ëª©ì 
ê¸°ê´€íˆ¬ìì(VIPí•œêµ­í˜•ê°€ì¹˜íˆ¬ì, êµ­ë¯¼ì—°ê¸ˆ ë“±)ì˜ í¬íŠ¸í´ë¦¬ì˜¤ ì¢…ëª©ì„ ëŒ€ìƒìœ¼ë¡œ ê¸°ìˆ ì  ë¶„ì„, ê¸°ë³¸ì  ë¶„ì„, ë‰´ìŠ¤/ê°ì • ë¶„ì„ì„ ìˆ˜í–‰í•˜ì—¬ ì¢…í•© ì ìˆ˜ë¥¼ ì‚°ì¶œí•˜ê³ , ì¸í„°ë™í‹°ë¸Œ ì›¹ ëŒ€ì‹œë³´ë“œë¡œ ì‹œê°í™”í•˜ëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•

### 1.2 í•µì‹¬ íŠ¹ì§•
- **3:5:2 ê°€ì¤‘ì¹˜ ë¶„ì„**: ê¸°ìˆ (30ì ) + ê¸°ë³¸(50ì ) + ê°ì •(20ì ) = 100ì 
- **ì¤‘ì¥ê¸° ê´€ì **: ê¸°ê´€ ê³µì‹œ ì‹œì°¨(1-2ê°œì›”)ë¥¼ ê°ì•ˆí•œ ì¤‘ì¥ê¸° íˆ¬ì ê´€ì 
- **ì €í‰ê°€ + ì„±ì¥ì„± + ë°°ë‹¹**: ê°€ì¹˜íˆ¬ì ê¸°ë°˜ + ì„±ì¥ì„± + ë°°ë‹¹ ì§€í‘œ í˜¼í•©
- **ì¬ë¬´ì•ˆì •ì„±**: ë¶€ì±„ë¹„ìœ¨, ìœ ë™ë¹„ìœ¨ ë“± ì•ˆì •ì„± ì§€í‘œ í¬í•¨
- **ìœ ë™ì„± ë¦¬ìŠ¤í¬**: ì†Œí˜•ì£¼/ì§‘ì¤‘ë³´ìœ  ì¢…ëª© ìœ ë™ì„± ê°ì  ì ìš©
- **AI ê°ì •ë¶„ì„**: OpenAI API í™œìš© ë‰´ìŠ¤ ê°ì • ë¶„ì„

### 1.3 ëŒ€ìƒ ë°ì´í„° ì†ŒìŠ¤
| ê¸°ê´€ | ê³µì‹œ ì£¼ê¸° | í™œìš© ë°©ì•ˆ |
|------|----------|----------|
| VIPí•œêµ­í˜•ê°€ì¹˜íˆ¬ì | ë¶„ê¸° | ìì‚°ìš´ìš©ë³´ê³ ì„œ PDF íŒŒì‹± |
| êµ­ë¯¼ì—°ê¸ˆ | ë¶„ê¸° | êµ­ë¯¼ì—°ê¸ˆ ê³µì‹œ ë°ì´í„° |
| ê¸°íƒ€ ê³µëª¨í€ë“œ | ë¶„ê¸° | ê¸ˆìœµíˆ¬ìí˜‘íšŒ ê³µì‹œ |

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

### 2.1 Backend
| êµ¬ë¶„ | ê¸°ìˆ  | ìš©ë„ |
|------|------|------|
| Framework | **FastAPI** | REST API ì„œë²„ |
| Database (ì‹œì„¸) | **SQLite** | ì£¼ê°€/ê±°ë˜ëŸ‰ íˆìŠ¤í† ë¦¬ (ë¡œì»¬ ì €ì¥) |
| Database (ë¶„ì„) | **Supabase (PostgreSQL)** | ë¶„ì„ ê²°ê³¼, í¬íŠ¸í´ë¦¬ì˜¤ (í´ë¼ìš°ë“œ) |
| ORM | **SQLAlchemy** | ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ |
| Task Queue | **Celery + Redis** | ë¹„ë™ê¸° ë¶„ì„ ì‘ì—… (ì„ íƒ) |
| ìŠ¤ì¼€ì¤„ëŸ¬ | **GitHub Actions** | ì •ê¸° ë°ì´í„° ìˆ˜ì§‘ (ë§¤ì¼ 20:30 KST) |

**ë°ì´í„°ë² ì´ìŠ¤ ë¶„ë¦¬ ì „ëµ**:
| êµ¬ë¶„ | ì €ì¥ì†Œ | ì´ìœ  |
|------|--------|------|
| ì‹œì„¸ ë°ì´í„° | SQLite (ë¡œì»¬) | ëŒ€ìš©ëŸ‰, ë¹ ë¥¸ ì¡°íšŒ, ì˜¤í”„ë¼ì¸ ê°€ëŠ¥ |
| ë¶„ì„ ê²°ê³¼ | Supabase | í´ë¼ìš°ë“œ ë™ê¸°í™”, ëŒ€ì‹œë³´ë“œ ì—°ë™ |
| í¬íŠ¸í´ë¦¬ì˜¤ | Supabase | ë‹¤ì¤‘ ê¸°ê¸° ì ‘ê·¼, ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ |

### 2.2 Frontend
| êµ¬ë¶„ | ê¸°ìˆ  | ìš©ë„ |
|------|------|------|
| Framework | **React 18** | SPA í”„ë¡ íŠ¸ì—”ë“œ |
| ìƒíƒœê´€ë¦¬ | **Zustand** | ì „ì—­ ìƒíƒœ ê´€ë¦¬ |
| UI Library | **Tailwind CSS + shadcn/ui** | ìŠ¤íƒ€ì¼ë§ |
| ì°¨íŠ¸ | **Recharts / TradingView Lightweight** | ì£¼ê°€ ì°¨íŠ¸, ì ìˆ˜ ì‹œê°í™” |
| HTTP Client | **Axios + React Query** | API í†µì‹  |

### 2.3 External APIs (ë©€í‹°ì†ŒìŠ¤ ì „ëµ)

| ë°ì´í„° | 1ì°¨ ì†ŒìŠ¤ | ë°±ì—… ì†ŒìŠ¤ | ë¹„ìš© |
|--------|----------|----------|------|
| **ì£¼ê°€/ê±°ë˜ëŸ‰** | KIS Trading API | pykrx | ë¬´ë£Œ |
| **ì¬ë¬´ì œí‘œ** | ë„¤ì´ë²„ê¸ˆìœµ í¬ë¡¤ë§ | DART OpenAPI | ë¬´ë£Œ |
| **PER/PBR/ì—…ì¢…í‰ê· ** | ë„¤ì´ë²„ê¸ˆìœµ í¬ë¡¤ë§ | KRX ì •ë³´ë°ì´í„° | ë¬´ë£Œ |
| **ë°°ë‹¹ì •ë³´** | ë„¤ì´ë²„ê¸ˆìœµ í¬ë¡¤ë§ | KRX/DART | ë¬´ë£Œ |
| **ê²€ìƒ‰ íŠ¸ë Œë“œ** | Google Trends | - | ë¬´ë£Œ |
| **ë‰´ìŠ¤ ìˆ˜ì§‘** | Google Search | ë„¤ì´ë²„ ë‰´ìŠ¤ | ë¬´ë£Œ |
| **ë‰´ìŠ¤ ê°ì •ë¶„ì„** | OpenAI API | - | ìœ ë£Œ (ì¢…ëŸ‰ì œ) |

**âš ï¸ ë°ì´í„° ìˆ˜ì§‘ ìš°ì„ ìˆœìœ„**: 1ì°¨ ì†ŒìŠ¤ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ë°±ì—… ì†ŒìŠ¤ ì‹œë„

---

## 3. ì ìˆ˜ ì‚°ì¶œ ê³µì‹

### 3.1 ì´ì  ê³„ì‚°
```
ì´ì (100) = ê¸°ìˆ ë¶„ì„(30) + ê¸°ë³¸ë¶„ì„(50) + ê°ì •ë¶„ì„(20) - ìœ ë™ì„±ê°ì (ìµœëŒ€ 5)
```

> **ê°€ì¤‘ì¹˜ ê·¼ê±°**: ê¸°ê´€ ê°€ì¹˜íˆ¬ì í€ë“œ íŠ¹ì„±ìƒ ê¸°ë³¸ë¶„ì„(ì¬ë¬´/ë°¸ë¥˜ì—ì´ì…˜) ë¹„ì¤‘ì„ ë†’ê²Œ ì„¤ì •

---

### 3.2 ê¸°ìˆ ë¶„ì„ (30ì )

```
ê¸°ìˆ ì ìˆ˜ = ì¶”ì„¸(12) + ëª¨ë©˜í…€(10) + ê±°ë˜ëŸ‰(8)
```

| ì§€í‘œ | ë°°ì  | ì‚°ì¶œ ë¡œì§ |
|------|------|----------|
| **MA ë°°ì—´** | 6ì  | 5MA > 20MA > 60MA > 120MA ì •ë°°ì—´: 6ì  / ì—­ë°°ì—´: 0ì  / ë¶€ë¶„ì •ë°°ì—´: ë¹„ë¡€ |
| **MA ì´ê²©ë„** | 6ì  | í˜„ì¬ê°€ vs 20MA ì´ê²©ë¥  (-10%~+10% êµ¬ê°„ ì •ê·œí™”) |
| **RSI(14)** | 5ì  | RSI â‰¤ 30: 5ì (ê³¼ë§¤ë„) / RSI â‰¥ 70: 0ì (ê³¼ë§¤ìˆ˜) / ì¤‘ê°„: ì„ í˜• ë¹„ë¡€ |
| **MACD** | 5ì  | ì‹œê·¸ë„ì„  ìƒí–¥ëŒíŒŒ: 5ì  / í•˜í–¥ëŒíŒŒ: 0ì  / ìœ ì§€: 2.5ì  |
| **ê±°ë˜ëŸ‰** | 8ì  | ë‹¹ì¼ê±°ë˜ëŸ‰ / 20ì¼í‰ê· ê±°ë˜ëŸ‰ ë¹„ìœ¨ (1.5ë°° ì´ìƒ ì‹œ ê°€ì ) |

**ê¸°ìˆ ë¶„ì„ ì„¸ë¶€ ê³µì‹**:
```python
# MA ë°°ì—´ ì ìˆ˜ (6ì  ë§Œì )
def calc_ma_arrangement(ma5, ma20, ma60, ma120):
    score = 0
    if ma5 > ma20: score += 1.5
    if ma20 > ma60: score += 2.25
    if ma60 > ma120: score += 2.25
    return score

# MA ì´ê²©ë„ ì ìˆ˜ (6ì  ë§Œì )
def calc_ma_divergence(price, ma20):
    divergence = (price - ma20) / ma20 * 100
    # -10% ~ +10% êµ¬ê°„ì„ 0~6ì ìœ¼ë¡œ ì •ê·œí™”
    score = (divergence + 10) / 20 * 6
    return max(0, min(6, score))

# RSI ì ìˆ˜ (5ì  ë§Œì )
def calc_rsi_score(rsi):
    if rsi <= 30:
        return 5
    elif rsi >= 70:
        return 0
    else:
        return (70 - rsi) / 40 * 5

# MACD ì ìˆ˜ (5ì  ë§Œì )
def calc_macd_score(macd, signal, prev_macd, prev_signal):
    if prev_macd <= prev_signal and macd > signal:
        return 5  # ê³¨ë“ í¬ë¡œìŠ¤
    elif prev_macd >= prev_signal and macd < signal:
        return 0  # ë°ë“œí¬ë¡œìŠ¤
    elif macd > signal:
        return 3.5  # MACD > Signal ìœ ì§€
    else:
        return 1.5  # MACD < Signal ìœ ì§€

# ê±°ë˜ëŸ‰ ì ìˆ˜ (8ì  ë§Œì )
def calc_volume_score(volume, avg_volume_20):
    ratio = volume / avg_volume_20
    if ratio >= 2.0:
        return 8
    elif ratio >= 1.5:
        return 6.5
    elif ratio >= 1.0:
        return 5
    elif ratio >= 0.5:
        return 3
    else:
        return 1.5
```

---

### 3.3 ê¸°ë³¸ë¶„ì„ (50ì )

```
ê¸°ë³¸ì ìˆ˜ = ì €í‰ê°€(20) + ì„±ì¥ì„±(12) + ìˆ˜ìµì„±(10) + ì¬ë¬´ì•ˆì •ì„±(8)
```

| ì¹´í…Œê³ ë¦¬ | ì§€í‘œ | ë°°ì  | ì‚°ì¶œ ë¡œì§ |
|---------|------|------|----------|
| **ì €í‰ê°€** | PER | 8ì  | ì—…ì¢…í‰ê·  ëŒ€ë¹„ ë¹„ìœ¨ (ë‚®ì„ìˆ˜ë¡ ê³ ì ìˆ˜) / âš ï¸ **ì ì ì‹œ 0ì ** |
| | PBR | 7ì  | ì—…ì¢…í‰ê·  ëŒ€ë¹„ ë¹„ìœ¨ (1 ë¯¸ë§Œ ì‹œ ê°€ì ) |
| | PSR | 5ì  | ì—…ì¢…í‰ê·  ëŒ€ë¹„ ë¹„ìœ¨ (ë‚®ì„ìˆ˜ë¡ ê³ ì ìˆ˜) |
| **ì„±ì¥ì„±** | ë§¤ì¶œì„±ì¥ë¥  | 6ì  | ìµœê·¼ 3ë…„ CAGR ê¸°ì¤€ |
| | ì˜ì—…ì´ìµì„±ì¥ë¥  | 6ì  | ìµœê·¼ 3ë…„ CAGR ê¸°ì¤€ |
| **ìˆ˜ìµì„±** | ROE | 5ì  | 15% ì´ìƒ: 5ì  / 10%: 4ì  / 5%: 2.5ì  / 0% ì´ìƒ: 1ì  / ë§ˆì´ë„ˆìŠ¤: 0ì  |
| | ì˜ì—…ì´ìµë¥  | 5ì  | ì—…ì¢…í‰ê·  ëŒ€ë¹„ ë¹„ìœ¨ |
| **ì¬ë¬´ì•ˆì •ì„±** | ë¶€ì±„ë¹„ìœ¨ | 4ì  | 100% ì´í•˜: 4ì  / 150%: 3ì  / 200%: 2ì  / 300%: 1ì  / ì´ˆê³¼: 0ì  |
| | ìœ ë™ë¹„ìœ¨ | 4ì  | 200% ì´ìƒ: 4ì  / 150%: 3ì  / 100%: 2ì  / 50%: 1ì  / ë¯¸ë§Œ: 0ì  |

**ê¸°ë³¸ë¶„ì„ ì„¸ë¶€ ê³µì‹**:
```python
# PER ì ìˆ˜ (8ì  ë§Œì ) - ì ìê¸°ì—… íŒ¨ë„í‹° ì ìš©
def calc_per_score(per, industry_per):
    if per is None or per <= 0:  # ì ìê¸°ì—…
        return 0  # âš ï¸ íŒ¨ë„í‹°: 0ì  ì²˜ë¦¬

    ratio = per / industry_per
    if ratio <= 0.5:
        return 8
    elif ratio <= 0.75:
        return 6
    elif ratio <= 1.0:
        return 4.5
    elif ratio <= 1.25:
        return 3
    elif ratio <= 1.5:
        return 2
    else:
        return 1

# PBR ì ìˆ˜ (7ì  ë§Œì )
def calc_pbr_score(pbr, industry_pbr):
    ratio = pbr / industry_pbr
    if ratio <= 0.5:
        return 7
    elif ratio <= 0.75:
        return 5.5
    elif ratio <= 1.0:
        return 4
    elif ratio <= 1.5:
        return 2
    else:
        return 1

# PSR ì ìˆ˜ (5ì  ë§Œì )
def calc_psr_score(psr, industry_psr):
    ratio = psr / industry_psr
    if ratio <= 0.5:
        return 5
    elif ratio <= 0.75:
        return 4
    elif ratio <= 1.0:
        return 3
    elif ratio <= 1.5:
        return 1.5
    else:
        return 0.5

# ì„±ì¥ë¥  ì ìˆ˜ (6ì  ë§Œì )
def calc_growth_score(cagr):
    if cagr >= 30:
        return 6
    elif cagr >= 20:
        return 5
    elif cagr >= 15:
        return 4
    elif cagr >= 10:
        return 3
    elif cagr >= 5:
        return 2
    elif cagr >= 0:
        return 1
    else:
        return 0

# ROE ì ìˆ˜ (5ì  ë§Œì )
def calc_roe_score(roe):
    if roe >= 15:
        return 5
    elif roe >= 10:
        return 4
    elif roe >= 5:
        return 2.5
    elif roe >= 0:
        return 1
    else:
        return 0

# ì˜ì—…ì´ìµë¥  ì ìˆ˜ (5ì  ë§Œì )
def calc_margin_score(margin, industry_margin):
    ratio = margin / industry_margin if industry_margin > 0 else 0
    if ratio >= 1.5:
        return 5
    elif ratio >= 1.2:
        return 4
    elif ratio >= 1.0:
        return 3
    elif ratio >= 0.8:
        return 2
    else:
        return 1

# ë¶€ì±„ë¹„ìœ¨ ì ìˆ˜ (4ì  ë§Œì )
def calc_debt_ratio_score(debt_ratio):
    if debt_ratio <= 100:
        return 4
    elif debt_ratio <= 150:
        return 3
    elif debt_ratio <= 200:
        return 2
    elif debt_ratio <= 300:
        return 1
    else:
        return 0

# ìœ ë™ë¹„ìœ¨ ì ìˆ˜ (4ì  ë§Œì )
def calc_current_ratio_score(current_ratio):
    if current_ratio >= 200:
        return 4
    elif current_ratio >= 150:
        return 3
    elif current_ratio >= 100:
        return 2
    elif current_ratio >= 50:
        return 1
    else:
        return 0
```

---

### 3.4 ë‰´ìŠ¤/ê°ì •ë¶„ì„ (20ì )

```
ê°ì •ì ìˆ˜ = êµ¬ê¸€íŠ¸ë Œë“œ(8) + ë‰´ìŠ¤ê°ì •(12)
```

| ì§€í‘œ | ë°°ì  | ì‚°ì¶œ ë¡œì§ |
|------|------|----------|
| **êµ¬ê¸€íŠ¸ë Œë“œ** | 8ì  | ìµœê·¼ 30ì¼ ê²€ìƒ‰ëŸ‰ ì¶”ì´ (ìƒìŠ¹: ê°€ì , í•˜ë½: ê°ì ) |
| **ë‰´ìŠ¤ê°ì •** | 12ì  | ìµœê·¼ ë‰´ìŠ¤ 5ê°œ â†’ OpenAI ê°ì •ë¶„ì„ |

**âš ï¸ ë°ì´í„° ë¶€ì¡± ì²˜ë¦¬**:
```python
# ê²€ìƒ‰ëŸ‰ ë¶€ì¡± ì‹œ ì¤‘ë¦½ ì²˜ë¦¬
def calc_trend_score(trend_data):
    if trend_data is None or len(trend_data) == 0:
        return {
            "score": 4,  # 8ì  ë§Œì  ì¤‘ 50% = 4ì 
            "flag": "âš ï¸ ë°ì´í„° ë¶€ì¡±"
        }
    # ì •ìƒ ê³„ì‚° ë¡œì§...
```

**ë‰´ìŠ¤ ê°ì •ë¶„ì„ í”„ë¡œì„¸ìŠ¤**:
```
1. êµ¬ê¸€ ê²€ìƒ‰: "{ì¢…ëª©ëª…} ì£¼ì‹" ìµœê·¼ 1ì£¼ì¼
2. ìƒìœ„ 5ê°œ ë‰´ìŠ¤ ì œëª© + ìš”ì•½ ìˆ˜ì§‘
3. OpenAI API í˜¸ì¶œ (gpt-4o-mini)
4. ê°ì • ì ìˆ˜ ë³€í™˜:
   - ë§¤ìš° ê¸ì •: 12ì 
   - ê¸ì •: 9ì 
   - ì¤‘ë¦½: 6ì 
   - ë¶€ì •: 3ì 
   - ë§¤ìš° ë¶€ì •: 0ì 
```

**OpenAI í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ**:
```python
SENTIMENT_PROMPT = """
ë‹¤ìŒ ì£¼ì‹ ê´€ë ¨ ë‰´ìŠ¤ë“¤ì˜ ì „ë°˜ì ì¸ ê°ì •ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.

ì¢…ëª©: {stock_name}
ë‰´ìŠ¤:
{news_list}

ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”:
- ë§¤ìš° ê¸ì • (ì£¼ê°€ ìƒìŠ¹ì— ê°•í•˜ê²Œ ê¸ì •ì )
- ê¸ì • (ì£¼ê°€ì— ê¸ì •ì )
- ì¤‘ë¦½ (ì˜í–¥ ì—†ìŒ ë˜ëŠ” íŒë‹¨ ë¶ˆê°€)
- ë¶€ì • (ì£¼ê°€ì— ë¶€ì •ì )
- ë§¤ìš° ë¶€ì • (ì£¼ê°€ í•˜ë½ì— ê°•í•˜ê²Œ ë¶€ì •ì )

ë‹µë³€ í˜•ì‹: {"sentiment": "ê°ì •", "reason": "ê°„ë‹¨í•œ ì´ìœ "}
"""
```

---

### 3.5 ìœ ë™ì„± ë¦¬ìŠ¤í¬ ê°ì  (ìµœëŒ€ -5ì )

```
ìœ ë™ì„±ê°ì  = ë³´ìœ ë¹„ìœ¨ê°ì (ìµœëŒ€ -3) + ê±°ë˜ëŒ€ê¸ˆê°ì (ìµœëŒ€ -2)
```

| ì§€í‘œ | ê°ì  | ì‚°ì¶œ ë¡œì§ |
|------|------|----------|
| **ë°œí–‰ì£¼ì‹ ëŒ€ë¹„ ë³´ìœ ë¹„ìœ¨** | -3ì  | 3% ì´ìƒ: -3ì  / 2%: -2ì  / 1%: -1ì  / ë¯¸ë§Œ: 0ì  |
| **ì¼í‰ê·  ê±°ë˜ëŒ€ê¸ˆ** | -2ì  | 5ì–µ ë¯¸ë§Œ: -2ì  / 10ì–µ ë¯¸ë§Œ: -1ì  / ì´ìƒ: 0ì  |

**ìœ ë™ì„± ë¦¬ìŠ¤í¬ ì„¸ë¶€ ê³µì‹**:
```python
# ë³´ìœ ë¹„ìœ¨ ê°ì  (ìµœëŒ€ -3ì )
def calc_holding_ratio_penalty(holding_ratio):
    """ë°œí–‰ì£¼ì‹ìˆ˜ ëŒ€ë¹„ ê¸°ê´€ ë³´ìœ ë¹„ìœ¨ì— ë”°ë¥¸ ê°ì """
    if holding_ratio >= 3.0:  # 3% ì´ìƒ
        return -3
    elif holding_ratio >= 2.0:
        return -2
    elif holding_ratio >= 1.0:
        return -1
    return 0

# ê±°ë˜ëŒ€ê¸ˆ ê°ì  (ìµœëŒ€ -2ì )
def calc_trading_value_penalty(avg_trading_value_20d):
    """20ì¼ í‰ê·  ê±°ë˜ëŒ€ê¸ˆ(ì–µì›) ê¸°ì¤€ ê°ì """
    if avg_trading_value_20d < 5:  # 5ì–µ ë¯¸ë§Œ
        return -2
    elif avg_trading_value_20d < 10:  # 10ì–µ ë¯¸ë§Œ
        return -1
    return 0

# ìœ ë™ì„± ë¦¬ìŠ¤í¬ ì´ ê°ì 
def calc_liquidity_penalty(holding_ratio, avg_trading_value):
    return calc_holding_ratio_penalty(holding_ratio) + calc_trading_value_penalty(avg_trading_value)
```

**âš ï¸ ìœ ë™ì„± ë¦¬ìŠ¤í¬ ëŒ€ìƒ ì¢…ëª© ì˜ˆì‹œ** (VIPí•œê°€íˆ¬ ê¸°ì¤€):
- ì´ì—”ì—í”„í…Œí¬ë†€ë¡œì§€ (3.56%), ì›”ë±ìŠ¤ (4.07%), íœ´ë©”ë”•ìŠ¤ (3.87%), ìœ ë‹ˆí…ŒìŠ¤íŠ¸ (3.82%)
- í”„ë¡œí… (3.11%), íŒí…ì½”ë¦¬ì•„ (2.73%), CJí”„ë ˆì‹œì›¨ì´ (2.52%), ì—˜ì•¤ì”¨ë°”ì´ì˜¤ (2.46%)

---

## 4. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client (React)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ëŒ€ì‹œë³´ë“œ  â”‚ â”‚ ì¢…ëª©ìƒì„¸  â”‚ â”‚  í•„í„°    â”‚ â”‚  ì°¨íŠ¸    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP/REST
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FastAPI Backend                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  /api/stocks â”‚ â”‚ /api/analysisâ”‚ â”‚ /api/reports â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SQLite     â”‚ â”‚   Supabase    â”‚ â”‚    Redis      â”‚ â”‚    Celery     â”‚
â”‚   (ë¡œì»¬)      â”‚ â”‚  (PostgreSQL) â”‚ â”‚               â”‚ â”‚               â”‚
â”‚  - ì£¼ê°€íˆìŠ¤í† ë¦¬â”‚ â”‚  - ì¢…ëª©ì •ë³´    â”‚ â”‚  - ìºì‹œ       â”‚ â”‚  - ë¶„ì„ì‘ì—…    â”‚
â”‚  - ê±°ë˜ëŸ‰     â”‚ â”‚  - ë¶„ì„ê²°ê³¼    â”‚ â”‚  - ì„¸ì…˜       â”‚ â”‚  - ìŠ¤ì¼€ì¤„ë§    â”‚
â”‚  - ê¸°ìˆ ì§€í‘œ   â”‚ â”‚  - í¬íŠ¸í´ë¦¬ì˜¤  â”‚ â”‚               â”‚ â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                   â”‚                 â”‚       â”‚
        â–¼                                   â–¼                 â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   KIS API     â”‚               â”‚  ë„¤ì´ë²„ê¸ˆìœµ    â”‚     â”‚  Google APIs  â”‚
â”‚  - ì£¼ê°€       â”‚               â”‚  - ì¬ë¬´ì œí‘œ    â”‚     â”‚  - Trends     â”‚
â”‚  - ê±°ë˜ëŸ‰     â”‚               â”‚  - PER/PBR    â”‚     â”‚  - Search     â”‚
â”‚  - íˆìŠ¤í† ë¦¬   â”‚               â”‚  - ì—…ì¢…í‰ê·     â”‚     â”‚  - OpenAI     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. í”„ë¡œì íŠ¸ êµ¬ì¡°

```
stock-analysis/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py                 # FastAPI ì•± ì§„ì…ì 
â”‚   â”‚   â”œâ”€â”€ config.py               # í™˜ê²½ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ sqlite_db.py        # SQLite ì—°ê²° (ì‹œì„¸ ë°ì´í„°)
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase_db.py      # Supabase ì—°ê²° (ë¶„ì„ ë°ì´í„°)
â”‚   â”‚   â”‚   â””â”€â”€ sync.py             # ë°ì´í„° ë™ê¸°í™”
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stocks.py           # ì¢…ëª© API
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis.py         # ë¶„ì„ API
â”‚   â”‚   â”‚   â”œâ”€â”€ reports.py          # ë¦¬í¬íŠ¸ API
â”‚   â”‚   â”‚   â””â”€â”€ portfolios.py       # í¬íŠ¸í´ë¦¬ì˜¤ API
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stock.py            # ì¢…ëª© ëª¨ë¸
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis.py         # ë¶„ì„ê²°ê³¼ ëª¨ë¸
â”‚   â”‚   â”‚   â””â”€â”€ portfolio.py        # í¬íŠ¸í´ë¦¬ì˜¤ ëª¨ë¸
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ technical.py        # ê¸°ìˆ ë¶„ì„ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ fundamental.py      # ê¸°ë³¸ë¶„ì„ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ sentiment.py        # ê°ì •ë¶„ì„ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ scoring.py          # ì ìˆ˜ í†µí•© ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ collectors/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ kis_api.py          # KIS API ìˆ˜ì§‘ê¸°
â”‚   â”‚   â”‚   â”œâ”€â”€ naver_finance.py    # ë„¤ì´ë²„ê¸ˆìœµ í¬ë¡¤ëŸ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ google_trends.py    # êµ¬ê¸€íŠ¸ë Œë“œ ìˆ˜ì§‘ê¸°
â”‚   â”‚   â”‚   â””â”€â”€ news_collector.py   # ë‰´ìŠ¤ ìˆ˜ì§‘ê¸°
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ analyzers/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ openai_sentiment.py # OpenAI ê°ì •ë¶„ì„
â”‚   â”‚   â”‚   â””â”€â”€ indicators.py       # ê¸°ìˆ ì§€í‘œ ê³„ì‚°
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ helpers.py
â”‚   â”‚
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Loading.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StockTable.tsx      # ì¢…ëª© ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸”
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ScoreCard.tsx       # ì ìˆ˜ ì¹´ë“œ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FilterPanel.tsx     # í•„í„° íŒ¨ë„
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SortDropdown.tsx    # ì •ë ¬ ë“œë¡­ë‹¤ìš´
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ detail/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StockDetail.tsx     # ì¢…ëª© ìƒì„¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PriceChart.tsx      # ì£¼ê°€ ì°¨íŠ¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ScoreGauge.tsx      # ì ìˆ˜ ê²Œì´ì§€
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TechnicalTab.tsx    # ê¸°ìˆ ë¶„ì„ íƒ­
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FundamentalTab.tsx  # ê¸°ë³¸ë¶„ì„ íƒ­
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SentimentTab.tsx    # ê°ì •ë¶„ì„ íƒ­
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ charts/
â”‚   â”‚   â”‚       â”œâ”€â”€ CandlestickChart.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ ScoreDistribution.tsx
â”‚   â”‚   â”‚       â””â”€â”€ RadarChart.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StockDetailPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ReportPage.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useStocks.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useAnalysis.ts
â”‚   â”‚   â”‚   â””â”€â”€ useFilters.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ stockStore.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## 6. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 6.1 Supabase (PostgreSQL) - ë¶„ì„ ë°ì´í„°

```sql
-- ì¢…ëª© ê¸°ë³¸ ì •ë³´
CREATE TABLE stocks (
    id SERIAL PRIMARY KEY,
    code VARCHAR(10) UNIQUE NOT NULL,      -- ì¢…ëª©ì½”ë“œ
    name VARCHAR(100) NOT NULL,            -- ì¢…ëª©ëª…
    sector VARCHAR(50),                    -- ì—…ì¢…
    mapped_sector VARCHAR(50),             -- ë§¤í•‘ëœ ì—…ì¢… (ë¯¸ë¶„ë¥˜ ìˆ˜ë™ ë§¤í•‘ìš©)
    market VARCHAR(20),                    -- KOSPI/KOSDAQ
    market_cap BIGINT,                     -- ì‹œê°€ì´ì•¡
    shares_outstanding BIGINT,             -- ë°œí–‰ì£¼ì‹ìˆ˜
    avg_trading_value BIGINT,              -- 20ì¼ í‰ê·  ê±°ë˜ëŒ€ê¸ˆ
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ì—…ì¢… ë§¤í•‘ (ë¯¸ë¶„ë¥˜ ì¢…ëª© ìˆ˜ë™ ë§¤í•‘ìš©)
-- âš ï¸ ë¯¸ë¶„ë¥˜ ì¢…ëª©: ë‹¬ë°”ê¸€ë¡œë²Œ, ë™ë°©ë©”ë””ì»¬, ì—ìŠ¤ì— ì”¨ì§€ ë“±ì€ ìˆ˜ë™ìœ¼ë¡œ mapped_sector ì„¤ì •

-- í¬íŠ¸í´ë¦¬ì˜¤ (ê¸°ê´€ë³„)
CREATE TABLE portfolios (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,            -- VIPí•œê°€íˆ¬, êµ­ë¯¼ì—°ê¸ˆ ë“±
    source VARCHAR(50),                    -- ì¶œì²˜
    report_date DATE,                      -- ë³´ê³ ì„œ ê¸°ì¤€ì¼
    created_at TIMESTAMP DEFAULT NOW()
);

-- í¬íŠ¸í´ë¦¬ì˜¤-ì¢…ëª© ì—°ê²°
CREATE TABLE portfolio_stocks (
    id SERIAL PRIMARY KEY,
    portfolio_id INTEGER REFERENCES portfolios(id),
    stock_id INTEGER REFERENCES stocks(id),
    quantity BIGINT,                       -- ë³´ìœ ìˆ˜ëŸ‰
    amount BIGINT,                         -- í‰ê°€ê¸ˆì•¡
    weight DECIMAL(5,2),                   -- í¬íŠ¸í´ë¦¬ì˜¤ ë‚´ ë¹„ì¤‘(%)
    holding_ratio DECIMAL(5,2),            -- ë°œí–‰ì£¼ì‹ìˆ˜ ëŒ€ë¹„ ë³´ìœ ë¹„ìœ¨(%)
    is_concentrated BOOLEAN DEFAULT FALSE, -- ì§‘ì¤‘ë³´ìœ  ì—¬ë¶€ (5% ì´ˆê³¼)
    UNIQUE(portfolio_id, stock_id)
);

-- ì—…ì¢… í‰ê·  ë°ì´í„°
CREATE TABLE sector_averages (
    id SERIAL PRIMARY KEY,
    sector VARCHAR(50) NOT NULL,
    avg_per DECIMAL(10,2),
    avg_pbr DECIMAL(10,2),
    avg_psr DECIMAL(10,2),
    avg_roe DECIMAL(10,2),
    avg_operating_margin DECIMAL(10,2),
    base_date DATE,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(sector, base_date)
);

-- ë¶„ì„ ê²°ê³¼
CREATE TABLE analysis_results (
    id SERIAL PRIMARY KEY,
    stock_id INTEGER REFERENCES stocks(id),
    analysis_date DATE NOT NULL,

    -- ê¸°ìˆ ë¶„ì„ (30ì )
    tech_ma_arrangement DECIMAL(4,2),      -- MAë°°ì—´ (6ì )
    tech_ma_divergence DECIMAL(4,2),       -- MAì´ê²©ë„ (6ì )
    tech_rsi DECIMAL(4,2),                 -- RSI (5ì )
    tech_macd DECIMAL(4,2),                -- MACD (5ì )
    tech_volume DECIMAL(4,2),              -- ê±°ë˜ëŸ‰ (8ì )
    tech_total DECIMAL(5,2),               -- ê¸°ìˆ ë¶„ì„ ì´ì  (30ì )

    -- ê¸°ë³¸ë¶„ì„ (50ì )
    fund_per DECIMAL(4,2),                 -- PER (8ì )
    fund_pbr DECIMAL(4,2),                 -- PBR (7ì )
    fund_psr DECIMAL(4,2),                 -- PSR (5ì )
    fund_revenue_growth DECIMAL(4,2),      -- ë§¤ì¶œì„±ì¥ë¥  (6ì )
    fund_profit_growth DECIMAL(4,2),       -- ì˜ì—…ì´ìµì„±ì¥ë¥  (6ì )
    fund_roe DECIMAL(4,2),                 -- ROE (5ì )
    fund_margin DECIMAL(4,2),              -- ì˜ì—…ì´ìµë¥  (5ì )
    fund_debt_ratio DECIMAL(4,2),          -- ë¶€ì±„ë¹„ìœ¨ (4ì )
    fund_current_ratio DECIMAL(4,2),       -- ìœ ë™ë¹„ìœ¨ (4ì )
    fund_total DECIMAL(5,2),               -- ê¸°ë³¸ë¶„ì„ ì´ì  (50ì )
    is_loss_company BOOLEAN DEFAULT FALSE, -- ì ìê¸°ì—… ì—¬ë¶€

    -- ê°ì •ë¶„ì„ (20ì )
    sent_trend DECIMAL(4,2),               -- íŠ¸ë Œë“œ (8ì )
    sent_news DECIMAL(4,2),                -- ë‰´ìŠ¤ê°ì • (12ì )
    sent_total DECIMAL(5,2),               -- ê°ì •ë¶„ì„ ì´ì  (20ì )
    sent_data_insufficient BOOLEAN DEFAULT FALSE,  -- âš ï¸ ë°ì´í„°ë¶€ì¡± í”Œë˜ê·¸

    -- ìœ ë™ì„± ë¦¬ìŠ¤í¬ ê°ì  (ìµœëŒ€ -5ì )
    liquidity_holding_penalty DECIMAL(4,2),   -- ë³´ìœ ë¹„ìœ¨ ê°ì  (ìµœëŒ€ -3ì )
    liquidity_trading_penalty DECIMAL(4,2),   -- ê±°ë˜ëŒ€ê¸ˆ ê°ì  (ìµœëŒ€ -2ì )
    liquidity_total_penalty DECIMAL(4,2),     -- ìœ ë™ì„± ê°ì  í•©ê³„ (ìµœëŒ€ -5ì )

    -- ì´ì 
    total_score DECIMAL(5,2),              -- ì¢…í•©ì ìˆ˜ (100ì  - ìœ ë™ì„±ê°ì )

    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(stock_id, analysis_date)
);

-- ì¸ë±ìŠ¤ (Supabase)
CREATE INDEX idx_analysis_stock_date ON analysis_results(stock_id, analysis_date);
CREATE INDEX idx_stocks_sector ON stocks(sector);
CREATE INDEX idx_portfolio_stocks_portfolio ON portfolio_stocks(portfolio_id);
```

### 6.2 SQLite (ë¡œì»¬) - ì‹œì„¸ ë°ì´í„°

```sql
-- ì£¼ê°€ íˆìŠ¤í† ë¦¬ (ëŒ€ìš©ëŸ‰, ë¡œì»¬ ì €ì¥)
CREATE TABLE price_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    stock_code TEXT NOT NULL,              -- ì¢…ëª©ì½”ë“œ
    date TEXT NOT NULL,                    -- YYYY-MM-DD
    open_price INTEGER,
    high_price INTEGER,
    low_price INTEGER,
    close_price INTEGER,
    volume INTEGER,
    trading_value INTEGER,                 -- ê±°ë˜ëŒ€ê¸ˆ
    UNIQUE(stock_code, date)
);

-- ê¸°ìˆ ì§€í‘œ ìºì‹œ (ê³„ì‚° ê²°ê³¼ ì €ì¥)
CREATE TABLE technical_indicators (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    stock_code TEXT NOT NULL,
    date TEXT NOT NULL,
    ma5 REAL,
    ma20 REAL,
    ma60 REAL,
    ma120 REAL,
    rsi14 REAL,
    macd REAL,
    macd_signal REAL,
    macd_hist REAL,
    volume_ratio REAL,                     -- ê±°ë˜ëŸ‰ ë¹„ìœ¨ (ë‹¹ì¼/20ì¼í‰ê· )
    UNIQUE(stock_code, date)
);

-- ì¸ë±ìŠ¤ (SQLite)
CREATE INDEX idx_price_stock_date ON price_history(stock_code, date);
CREATE INDEX idx_tech_stock_date ON technical_indicators(stock_code, date);
```

### 6.3 ë°ì´í„° ë™ê¸°í™”

```python
# stock_codeë¡œ SQLite(ì‹œì„¸) â†” Supabase(ë¶„ì„) ì—°ê²°
# Supabase stocks.code = SQLite price_history.stock_code

def sync_analysis_with_price(stock_code: str, analysis_date: str):
    """ì‹œì„¸ ë°ì´í„°(SQLite) â†’ ë¶„ì„ ê²°ê³¼(Supabase) ë™ê¸°í™”"""
    # 1. SQLiteì—ì„œ ê¸°ìˆ ì§€í‘œ ì¡°íšŒ
    tech_data = sqlite_db.get_technical_indicators(stock_code, analysis_date)

    # 2. Supabaseì— ë¶„ì„ ê²°ê³¼ ì €ì¥
    supabase.table('analysis_results').upsert({
        'stock_id': get_stock_id(stock_code),
        'analysis_date': analysis_date,
        'tech_ma_arrangement': tech_data['ma_arrangement'],
        # ...
    })
```

---

## 7. API ì„¤ê³„

### 7.1 ì¢…ëª© API

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/stocks` | ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ (í•„í„°, ì •ë ¬, í˜ì´ì§•) |
| GET | `/api/stocks/{code}` | ì¢…ëª© ìƒì„¸ ì¡°íšŒ |
| GET | `/api/stocks/{code}/history` | ì£¼ê°€ íˆìŠ¤í† ë¦¬ |

### 7.2 ë¶„ì„ API

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/analysis` | ë¶„ì„ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ |
| GET | `/api/analysis/{code}` | ì¢…ëª©ë³„ ë¶„ì„ ìƒì„¸ |
| POST | `/api/analysis/run` | ë¶„ì„ ì‹¤í–‰ (ì „ì²´/íŠ¹ì • ì¢…ëª©) |
| GET | `/api/analysis/ranking` | ì ìˆ˜ ìˆœìœ„ |

### 7.3 í¬íŠ¸í´ë¦¬ì˜¤ API

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/portfolios` | í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ìŠ¤íŠ¸ |
| POST | `/api/portfolios` | í¬íŠ¸í´ë¦¬ì˜¤ ë“±ë¡ (PDF ì—…ë¡œë“œ) |
| GET | `/api/portfolios/{id}/stocks` | í¬íŠ¸í´ë¦¬ì˜¤ ë‚´ ì¢…ëª© |

### 7.4 ë¦¬í¬íŠ¸ API

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/api/reports/generate` | ë¦¬í¬íŠ¸ ìƒì„± (MD/Excel) |
| GET | `/api/reports/history` | ê³¼ê±° ë¦¬í¬íŠ¸ ì¡°íšŒ |

---

## 8. ê°œë°œ ì¼ì •

### Phase 1: MVP (4ì£¼)

| ì£¼ì°¨ | ì‘ì—… ë‚´ìš© |
|------|----------|
| **1ì£¼ì°¨** | í”„ë¡œì íŠ¸ ì…‹ì—…, DB ìŠ¤í‚¤ë§ˆ, ê¸°ë³¸ API êµ¬ì¡° |
| **2ì£¼ì°¨** | ë°ì´í„° ìˆ˜ì§‘ê¸° ê°œë°œ (KIS, ë„¤ì´ë²„ê¸ˆìœµ, êµ¬ê¸€) |
| **3ì£¼ì°¨** | ë¶„ì„ ì—”ì§„ ê°œë°œ (ê¸°ìˆ /ê¸°ë³¸/ê°ì • ì ìˆ˜ ì‚°ì¶œ) |
| **4ì£¼ì°¨** | React ëŒ€ì‹œë³´ë“œ MVP (í…Œì´ë¸”, í•„í„°, ìƒì„¸í˜ì´ì§€) |

**Phase 1 ì™„ë£Œ ê¸°ëŠ¥**:
- âœ… ì¢…ëª© ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸”
- âœ… í•„í„°ë§ (ì—…ì¢…, ì ìˆ˜ëŒ€)
- âœ… ì •ë ¬ (ì ìˆ˜ ê¸°ì¤€)
- âœ… ì¢…ëª© ìƒì„¸ í˜ì´ì§€
- âœ… ì£¼ê°€ ì°¨íŠ¸
- âœ… ì ìˆ˜ ê²Œì´ì§€/ì°¨íŠ¸

### Phase 2: í™•ì¥ (4ì£¼)

| ì£¼ì°¨ | ì‘ì—… ë‚´ìš© |
|------|----------|
| **5ì£¼ì°¨** | ì¢…ëª© ë¹„êµ ê¸°ëŠ¥, íˆìŠ¤í† ë¦¬ ì¡°íšŒ |
| **6ì£¼ì°¨** | ë°±í…ŒìŠ¤íŒ… ëª¨ë“ˆ ê°œë°œ |
| **7ì£¼ì°¨** | ì•Œë¦¼ ê¸°ëŠ¥, ë‹¤í¬ëª¨ë“œ |
| **8ì£¼ì°¨** | í¬íŠ¸í´ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜, ìµœì í™” |

**Phase 2 ì™„ë£Œ ê¸°ëŠ¥**:
- âœ… ì¢…ëª© ë¹„êµ ê¸°ëŠ¥
- âœ… ë¶„ì„ íˆìŠ¤í† ë¦¬ ì¡°íšŒ
- âœ… ì•Œë¦¼/í‘¸ì‹œ ê¸°ëŠ¥
- âœ… ë‹¤í¬ëª¨ë“œ
- âœ… í¬íŠ¸í´ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜
- âœ… ë°±í…ŒìŠ¤íŒ…

---

## 9. OpenAI API ë¹„ìš© ì˜ˆì¸¡

| í•­ëª© | ìˆ˜ëŸ‰ | í† í° ì˜ˆìƒ | ë¹„ìš© (gpt-4o-mini) |
|------|------|----------|-------------------|
| ì¢…ëª©ë‹¹ ë‰´ìŠ¤ | 5ê°œ | ~500 í† í° | ~$0.0003 |
| ì „ì²´ ì¢…ëª© (50ê°œ) | 250ê°œ | ~25,000 í† í° | ~$0.015 |
| ì¼ê°„ ë¶„ì„ (ì›” 20íšŒ) | - | ~500,000 í† í° | ~$0.30/ì›” |

**ì˜ˆìƒ ì›” ë¹„ìš©**: ì•½ $0.30 ~ $1.00 (gpt-4o-mini ê¸°ì¤€)

---

## 10. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# .env íŒŒì¼

# === Supabase (ë¶„ì„ ë°ì´í„°) ===
SUPABASE_URL=https://{project}.supabase.co
SUPABASE_KEY={anon_key}
SUPABASE_SERVICE_ROLE_KEY={service_role_key}  # ì„œë²„ì‚¬ì´ë“œìš©

# === SQLite (ì‹œì„¸ ë°ì´í„°) ===
SQLITE_DB_PATH=./data/price_history.db

# === KIS Trading API ===
KIS_APP_KEY={app_key}
KIS_APP_SECRET={app_secret}
KIS_ACCOUNT_TYPE=VIRTUAL  # VIRTUAL or REAL

# === OpenAI API ===
OPENAI_API_KEY=sk-...

# === ê¸°íƒ€ ===
REDIS_URL=redis://localhost:6379
LOG_LEVEL=INFO
```

---

## 11. ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘ ë°©ì•ˆ

| ë¦¬ìŠ¤í¬ | ì˜í–¥ë„ | ëŒ€ì‘ ë°©ì•ˆ |
|--------|--------|----------|
| ë„¤ì´ë²„ê¸ˆìœµ í¬ë¡¤ë§ ì°¨ë‹¨ | ë†’ìŒ | ìš”ì²­ ë”œë ˆì´, IP ë¶„ì‚°, ìºì‹± ê°•í™” |
| KIS API ì¥ì•  | ì¤‘ê°„ | ì¬ì‹œë„ ë¡œì§, ìºì‹±, ì¥ì•  ì•Œë¦¼ |
| OpenAI API ë¹„ìš© ì¦ê°€ | ë‚®ìŒ | ë¶„ì„ ì£¼ê¸° ì¡°ì ˆ, ëª¨ë¸ ë³€ê²½ |
| ë°ì´í„° í’ˆì§ˆ ì´ìŠˆ | ì¤‘ê°„ | ê²€ì¦ ë¡œì§, ì´ìƒì¹˜ ì²˜ë¦¬ |
| Supabase ì—°ê²° ì¥ì•  | ì¤‘ê°„ | ë¡œì»¬ ìºì‹±, ì¬ì‹œë„ ë¡œì§ |

---

## 12. ì°¸ê³ ì‚¬í•­

### 12.1 ì ìê¸°ì—… ì²˜ë¦¬
- PER í•­ëª©(8ì ) â†’ **0ì  ì²˜ë¦¬**
- ê¸°ë³¸ë¶„ì„ ë‹¤ë¥¸ í•­ëª©ì€ ì •ìƒ ê³„ì‚°
- UIì—ì„œ "âš ï¸ ì ìê¸°ì—…" ë¼ë²¨ í‘œì‹œ

### 12.2 ë°ì´í„° ë¶€ì¡± ì²˜ë¦¬
- êµ¬ê¸€íŠ¸ë Œë“œ ë°ì´í„° ì—†ì„ ì‹œ â†’ **4ì /8ì  (50%)**
- UIì—ì„œ "âš ï¸ ë°ì´í„° ë¶€ì¡±" ë¼ë²¨ í‘œì‹œ

### 12.3 ì—…ì¢…í‰ê·  ìˆ˜ì§‘
- ë„¤ì´ë²„ê¸ˆìœµ ì—…ì¢…ë³„ í˜ì´ì§€ì—ì„œ í¬ë¡¤ë§
- ì£¼ 1íšŒ ì—…ë°ì´íŠ¸
- ìƒˆë¡œìš´ ì—…ì¢… ë°œê²¬ ì‹œ ìë™ ì¶”ê°€

### 12.4 ë¯¸ë¶„ë¥˜ ì—…ì¢… ì²˜ë¦¬
- ë¯¸ë¶„ë¥˜ ì¢…ëª©: ë‹¬ë°”ê¸€ë¡œë²Œ, ë™ë°©ë©”ë””ì»¬, ì—ìŠ¤ì— ì”¨ì§€ ë“±
- **ì²˜ë¦¬ë°©ì‹**: `stocks.mapped_sector`ì— ìˆ˜ë™ìœ¼ë¡œ ìœ ì‚¬ ì—…ì¢… ë§¤í•‘
- ë§¤í•‘ ì „ê¹Œì§€ëŠ” ì „ì²´ ì‹œì¥ í‰ê·  ì‚¬ìš©

### 12.5 ìœ ë™ì„± ë¦¬ìŠ¤í¬ í‘œì‹œ
- ë°œí–‰ì£¼ì‹ ëŒ€ë¹„ ë³´ìœ ë¹„ìœ¨ 1% ì´ìƒ: "âš ï¸ ì†Œí˜•ì£¼ ìœ ë™ì„± ë¦¬ìŠ¤í¬"
- ë°œí–‰ì£¼ì‹ ëŒ€ë¹„ ë³´ìœ ë¹„ìœ¨ 3% ì´ìƒ: "ğŸ”´ ê³ ìœ„í—˜ ìœ ë™ì„±"
- UIì—ì„œ ë³„ë„ ì•„ì´ì½˜/ë¼ë²¨ë¡œ í‘œì‹œ

### 12.6 ìš°ì„ ì£¼ ì œì™¸
- ìš°ì„ ì£¼(ì˜ˆ: í˜„ëŒ€ì°¨ìš°)ëŠ” ë¶„ì„ ëŒ€ìƒì—ì„œ **ì œì™¸**
- í¬íŠ¸í´ë¦¬ì˜¤ í…Œì´ë¸”ì—ëŠ” í‘œì‹œí•˜ë˜ ë¶„ì„ ì ìˆ˜ ë¯¸ì‚°ì¶œ

---

**ë¬¸ì„œ ë²„ì „**: v1.2
**ìµœì¢… ìˆ˜ì •ì¼**: 2025ë…„ 1ì›” 31ì¼

---

## ë³€ê²½ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| v1.0 | 2025-01-30 | ìµœì´ˆ ì‘ì„± |
| v1.1 | 2025-01-31 | ì ìˆ˜ ê°€ì¤‘ì¹˜ ë³€ê²½ (3:5:2), ì¬ë¬´ì•ˆì •ì„±/ë°°ë‹¹ ì§€í‘œ ì¶”ê°€, ìœ ë™ì„± ë¦¬ìŠ¤í¬ ê°ì , ë©€í‹°ì†ŒìŠ¤ ë°ì´í„° ì „ëµ, ìš°ì„ ì£¼ ì œì™¸ |
| v1.2 | 2025-01-31 | DB ë¶„ë¦¬: SQLite(ì‹œì„¸) + Supabase(ë¶„ì„), ê¸°ìˆ ì§€í‘œ ìºì‹œ í…Œì´ë¸” ì¶”ê°€ |
